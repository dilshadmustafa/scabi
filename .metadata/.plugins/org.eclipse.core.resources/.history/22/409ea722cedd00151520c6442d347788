/**
 * @author Dilshad Mustafa
 * (c) Dilshad Mustafa
 * All Rights Reserved.
 * @version 1.0
 * @since 24-Feb-2016
 * File Name : ComputeConfig.java
 */
package com.dilmus.dilshad.scabi.client;

import java.util.HashMap;
import java.util.Set;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

/**
 * @author Dilshad Mustafa
 *
 */
public class ComputeConfig {
	public final static int CODE = 1;
	public final static int CLASS = 2;
	public final static int OBJECT = 3;

	private final Logger log = LoggerFactory.getLogger(ComputeConfig.class);
	private ComputeUnit m_unit = null;
	private Class<? extends ComputeUnit> m_class = null;
	private String m_code = null;
	private int m_configType = 0;
	private String m_jsonInput = null;
	private HashMap<String, String> m_outputMap = null;
	private int m_maxSplit = 1;
	private int m_maxRetry = 0;
	// Not used private HashMap<String, Boolean> m_splitStatusMap = null;
	// Not used private HashMap<String, Integer> m_failedSplitRetryMap = null;
	
	public ComputeConfig(ComputeUnit unit) {
		m_unit = unit;
		m_configType = ComputeConfig.OBJECT;
		m_maxSplit = 1;
		
		// Not used m_splitStatusMap =  new HashMap<String, Boolean>();
		// Not used m_failedSplitRetryMap = new HashMap<String, Integer>();
		
	}
	
	public ComputeConfig(Class<? extends ComputeUnit> cls) {
		m_class = cls;
		m_configType = ComputeConfig.CLASS;
		m_maxSplit = 1;
		
	}

	public ComputeConfig(String code) {
		m_code = code;
		m_configType = ComputeConfig.CODE;
		m_maxSplit = 1;
		
	}

	
	/* Not used
	public int setSplitStatus(int splitno, boolean status) {
		m_splitStatusMap.put("" + splitno, status);
		return 0;
	}
	
	public boolean getSplitStatus(int splitno) {
		return m_splitStatusMap.get("" + splitno);
	}
	
	public int setOrIncFailedSplitRetryMap(int splitno) {
		if (m_failedSplitRetryMap.containsKey("" + splitno)) {
			Integer value = m_failedSplitRetryMap.get(""+ splitno);
			int retriesTillNow = value.intValue() + 1;
			Integer newRetry = new Integer(retriesTillNow);
			m_failedSplitRetryMap.put("" + splitno, newRetry);
		} else {
			Integer newRetry = new Integer(0);
			m_failedSplitRetryMap.put("" + splitno, newRetry);
		}
			
		return 0;
	}
	
	public int incIfExistsFailedSplitRetryMap(int splitno) {
		if (m_failedSplitRetryMap.containsKey("" + splitno)) {
			Integer value = m_failedSplitRetryMap.get(""+ splitno);
			int retriesTillNow = value.intValue() + 1;
			Integer newRetry = new Integer(retriesTillNow);
			m_failedSplitRetryMap.put("" + splitno, newRetry);
		} else {
			return -1; // What to do by throwing exception here?
		}
			
		return 0;
	}

	
	public HashMap<String, Integer> getFailedSplitRetryMap() {
		return m_failedSplitRetryMap;
	}
	*/
	
	public int getConfigType() {
		return m_configType;
	}
	
	public ComputeUnit getComputeUnit() {
		return m_unit;
	}

	public Class<? extends ComputeUnit> getComputeClass() {
		return m_class;
	}
	
	
	public int setInput(String jsonInput) {
		m_jsonInput = jsonInput;
		return 0;
	}
	
	public int setOutput(HashMap<String, String> outputMap) {
		m_outputMap = outputMap;
		return 0;
	}
	
	public int setResult(int splitno, String result) {
		if (m_outputMap != null) {
			m_outputMap.put("" + splitno, result);
			log.debug("setResult() Setting result for splitno : {}, {}", splitno, result);
		}
		
    	Set<String> st = m_outputMap.keySet();
    	for (String s : st) {
    		log.debug("setResult() for {} : {}", s, m_outputMap.get(s));
    		//System.out.println("setResult() s : " + s + " value : " + m_outputMap.get(s));
    	}

		return 0;
	}

	public int setMaxSplit(int maxSplit) {
		m_maxSplit = maxSplit;
		return 0;
	}
	
	public int setMaxRetry(int maxRetry) {
		m_maxRetry = maxRetry;
		return 0;
	}
	
	public String getInput() {
		return m_jsonInput;
	}
	
	public HashMap<String, String> getOutput() {
		return m_outputMap;
	}
	
	public int getMaxSplit() {
		return m_maxSplit;
	}
	
	public int getMaxRetry() {
		return m_maxRetry;
	}

}
