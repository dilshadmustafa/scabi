package com.dilmus.scabi.mns;

import static spark.Spark.*;

// MongoDB
import java.net.UnknownHostException;
import java.util.Date;
import com.mongodb.BasicDBObject;
import com.mongodb.DB;
import com.mongodb.DBCollection;
import com.mongodb.DBCursor;
import com.mongodb.MongoClient;
import com.mongodb.MongoException;


public class MNSMain {

    public static void main(String[] args) {
        // get("/hello", (req, res) -> "Hello World MNS4");
        System.out.println("from jar file Hello world MNS4");
        MNSMain.testdb();
    
    }
	
	public static int testdb() {
		
	    try {

	    	// Connect to MongoDB
	    	// Since 2.10.0, uses MongoClient
	    	MongoClient mongo = new MongoClient("localhost", 27017);

	    	// Get database
	    	// if database doesn't exists, MongoDB will create it for you
	    	DB db = mongo.getDB("MetaDB");

	    	// Get collection / table from MetaDB
	    	// if collection doesn't exists, MongoDB will create it for you
	    	DBCollection table = db.getCollection("ComputeMetaData");

	    	// Insert
	    	// create a document to store key and value
	    	BasicDBObject document = new BasicDBObject();
	    	document.put("Host", "localhost");
	    	document.put("Port", 4568);
	    	document.put("RegisteredDate", new Date());
	    	document.put("Status", "Available"); // Available, Inuse, Hold, Blocked
	    	table.insert(document);

	    	// Find and display
	    	BasicDBObject searchQuery = new BasicDBObject();
	    	searchQuery.put("Status", "Available");

	    	DBCursor cursor = table.find(searchQuery);

	    	while (cursor.hasNext()) {
	    		System.out.println(cursor.next());
	    	}

	    	// Update
	    	// search document where Status="Available" and update it with new values
	    	BasicDBObject query = new BasicDBObject();
	    	query.put("Status", "Available");

	    	BasicDBObject newDocument = new BasicDBObject();
	    	newDocument.put("Status", "Inuse");

	    	BasicDBObject updateObj = new BasicDBObject();
	    	updateObj.put("$set", newDocument);

	    	table.update(query, updateObj);

	    	// Find and display
	    	BasicDBObject searchQuery2 
	    	    = new BasicDBObject().append("Status", "Inuse");

	    	DBCursor cursor2 = table.find(searchQuery2);

	    	while (cursor2.hasNext()) {
	    		System.out.println(cursor2.next());
	    	}

	    	System.out.println("Done");

	        } catch (MongoException e) {
	        	e.printStackTrace();
	        }
	    	return 0;
	}
	
}
